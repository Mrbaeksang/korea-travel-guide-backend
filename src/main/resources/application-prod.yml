server:
  forward-headers-strategy: framework  # Railway 리버스 프록시 HTTPS 인식

spring:

  h2:
    console:
      enabled: false  # 프로덕션 환경에서 H2 Console 비활성화 (보안)
  
  datasource:
    url: jdbc:postgresql://${PGHOST}:${PGPORT}/${PGDATABASE}
    username: ${PGUSER}
    password: ${POSTGRES_PASSWORD}
    driver-class-name: org.postgresql.Driver

  jpa:
    hibernate:
      ddl-auto: update  # 운영 환경: 기존 테이블 유지하고 변경사항만 적용
    properties:
      hibernate:
        format_sql: true
        # dialect 설정 제거: Hibernate 6.x부터 JDBC URL 기반으로 자동 감지되며, 명시적 설정은 deprecated됨

  ai:
    vectorstore:
      jdbc:
        initialize-schema: true
    chat:
      memory:
        repository:
          jdbc:
            initialize-schema: always

  data:
    redis:  # 캐싱 전용 (세션 저장 안함 - JWT 기반 stateless 인증 사용)
      host: ${REDISHOST}
      port: ${REDISPORT}
      password: ${REDIS_PASSWORD}
      username: ${REDISUSER}

  # RabbitMQ 설정 (WebSocket STOMP Relay용)
  rabbitmq:
    host: rabbitmq.railway.internal
    port: 5672
    username: ${RABBITMQ_DEFAULT_USER}
    password: ${RABBITMQ_DEFAULT_PASS}
    stomp-port: 61613
    connection-timeout: 5000
    requested-heartbeat: 30

  session:
    store-type: none  # JWT 기반 인증 사용 - 세션 불필요

management:
  endpoints:
    web:
      exposure:
        include: health
  endpoint:
    health:
      show-details: never

logging:
  level:
    root: INFO
    com.back: DEBUG               # AI 툴 호출 디버깅을 위해 DEBUG로 변경
    org.springframework.web: WARN # 웹 관련 경고/에러만
    org.springframework.security: WARN # 로그인 실패/보안 경고 위주
    org.springframework.ai: INFO  # Spring AI 로그 활성화
    org.springframework.amqp: DEBUG # RabbitMQ 연결 디버그
    org.springframework.boot.autoconfigure.amqp: DEBUG # RabbitMQ AutoConfiguration 디버그
    org.hibernate.SQL: WARN       # SQL 로그 비활성화 (프로덕션 성능 및 로그 용량 최적화). 디버깅 필요시 INFO로 변경
  pattern:
    console: "[%d{yyyy-MM-dd HH:mm:ss}] %-5level %logger{36} - %msg%n"

custom:
  site:
    frontUrl: "${custom.prod.frontUrl}"
    backUrl: "${custom.prod.backUrl}"
  cookie:
    secure: true  # 프로덕션 환경: HTTPS에서만 쿠키 전송
